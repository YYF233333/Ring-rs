# Manifest 配置指南

`assets/manifest.json` 用于配置立绘的布局参数，让不同尺寸的立绘能够一致地显示在画面中。

## 基本结构

```json
{
  "characters": {
    "groups": { ... },    // 立绘组配置
    "sprites": { ... }    // 立绘路径到组的映射
  },
  "presets": { ... },     // 站位预设
  "defaults": { ... }     // 默认配置
}
```

## 核心概念

### 1. 锚点 (Anchor)

锚点定义立绘的对齐基准点，使用归一化坐标 (0.0 - 1.0)：

- `x: 0.0` = 左边缘，`x: 0.5` = 水平中心，`x: 1.0` = 右边缘
- `y: 0.0` = 顶部，`y: 0.5` = 垂直中心，`y: 1.0` = 底部

**示例**：`anchor: { x: 0.5, y: 1.0 }` 表示以立绘的底部中心为对齐点。

### 2. 预缩放 (pre_scale)

立绘加载时应用的基础缩放，用于归一化不同尺寸的立绘：

- `pre_scale: 1.0` = 原始尺寸
- `pre_scale: 0.8` = 缩小到 80%
- `pre_scale: 1.2` = 放大到 120%

### 3. 站位预设 (Preset)

定义屏幕上的位置和额外缩放：

```json
{
  "x": 0.5,    // 屏幕 X 坐标 (0.0 = 左边，1.0 = 右边)
  "y": 0.95,  // 屏幕 Y 坐标 (0.0 = 顶部，1.0 = 底部)
  "scale": 1.0 // 额外缩放
}
```

## 配置示例

```json
{
  "characters": {
    "groups": {
      "北风": {
        "anchor": { "x": 0.5, "y": 1.0 },
        "pre_scale": 0.9
      },
      "高个角色": {
        "anchor": { "x": 0.5, "y": 0.95 },
        "pre_scale": 0.75
      }
    },
    "sprites": {
      "characters/北风-日常服.png": "北风",
      "characters/北风-制服.png": "北风"
    }
  },
  "presets": {
    "left": { "x": 0.15, "y": 0.95, "scale": 1.0 },
    "center": { "x": 0.50, "y": 0.95, "scale": 1.0 },
    "right": { "x": 0.85, "y": 0.95, "scale": 1.0 },
    "farleft": { "x": 0.08, "y": 0.90, "scale": 0.85 },
    "farright": { "x": 0.92, "y": 0.90, "scale": 0.85 }
  },
  "defaults": {
    "anchor": { "x": 0.5, "y": 1.0 },
    "pre_scale": 1.0
  }
}
```

## 配置查找顺序

当显示立绘时，系统按以下顺序查找配置：

1. **显式映射**：检查 `sprites` 中是否有该路径的映射
2. **路径推导**：从路径中提取目录名或文件名前缀作为 group ID
3. **默认配置**：使用 `defaults` 中的配置

### 路径推导规则

```
characters/北风/日常服.png  → group ID: "北风"
characters/北风-日常服.png  → group ID: "北风"
北风-日常服.png            → group ID: "北风"
```

## 常见场景

### 场景 1：立绘太高，超出画面

```json
{
  "groups": {
    "高个角色": {
      "anchor": { "x": 0.5, "y": 0.9 },  // 向上移动锚点
      "pre_scale": 0.7                    // 缩小立绘
    }
  }
}
```

### 场景 2：立绘需要对齐脚部

```json
{
  "groups": {
    "普通角色": {
      "anchor": { "x": 0.5, "y": 1.0 },  // 底部中心对齐
      "pre_scale": 1.0
    }
  }
}
```

### 场景 3：远景角色（更小、更高）

```json
{
  "presets": {
    "far_center": {
      "x": 0.5,
      "y": 0.85,    // 更高
      "scale": 0.7  // 更小
    }
  }
}
```

## 校验规则

系统会自动校验配置：

- ⚠️ 锚点超出 [0.0, 1.0] 范围
- ⚠️ 预缩放 ≤ 0
- ⚠️ 预设位置超出 [0.0, 1.0] 范围
- ⚠️ sprite 引用不存在的 group

校验失败时会打印警告，但不会阻止运行。

## 最佳实践

1. **先配置 defaults**：设置合理的默认值
2. **按角色分组**：相同角色的不同立绘应该使用相同的组配置
3. **使用路径推导**：遵循命名规范可以减少显式映射
4. **预设复用**：为常用站位定义预设，脚本中直接使用 `at left/center/right`
